# نظام تذكيرات السداد عبر البريد الإلكتروني - قرشين

## نظرة عامة

تم تطوير نظام شامل لإرسال تذكيرات السداد عبر البريد الإلكتروني لمنصة قرشين. يوفر النظام إدارة تلقائية لتذكيرات السداد مع قوالب بريد إلكتروني احترافية باللغة العربية.

## الميزات الرئيسية

### 📧 **خدمة البريد الإلكتروني**
- قوالب بريد إلكتروني احترافية باللغة العربية
- دعم RTL (من اليمين إلى اليسار)
- تصميم متجاوب لجميع الأجهزة
- ثلاثة أنواع من التذكيرات: قريب الاستحقاق، متأخر، إشعار نهائي

### ⏰ **نظام الجدولة التلقائي**
- جدولة تلقائية للتذكيرات بناءً على تواريخ الاستحقاق
- إعدادات قابلة للتخصيص لأوقات الإرسال
- إدارة ذكية للمحاولات المتعددة
- تتبع حالة كل تذكير

### 🔗 **التكامل مع النظام**
- تكامل كامل مع نظام إدارة القروض الموجود
- تحديث تلقائي لحالة القروض
- ربط مع نظام المدفوعات
- إحصائيات مفصلة

### ⚙️ **إدارة الإعدادات**
- واجهة إدارة شاملة للإعدادات
- اختبار إرسال البريد الإلكتروني
- إعدادات قابلة للتخصيص
- وضع التصحيح والاختبار

## الملفات المطورة

### 1. **خدمة البريد الإلكتروني** (`src/lib/emailService.ts`)
```typescript
// الميزات الرئيسية:
- إنشاء قوالب البريد الإلكتروني
- إرسال التذكيرات
- إدارة إعدادات البريد الإلكتروني
- دعم أنواع مختلفة من التذكيرات
```

### 2. **نظام الجدولة** (`src/lib/reminderScheduler.ts`)
```typescript
// الميزات الرئيسية:
- جدولة التذكيرات التلقائية
- إدارة حالة التذكيرات
- إعدادات قابلة للتخصيص
- تتبع المحاولات
```

### 3. **التكامل مع النظام** (`src/lib/loanReminderIntegration.ts`)
```typescript
// الميزات الرئيسية:
- ربط مع نظام القروض الموجود
- إدارة القروض النشطة
- معالجة المدفوعات
- إحصائيات مفصلة
```

### 4. **واجهة الإدارة** (`src/components/ReminderManager.tsx`)
```typescript
// الميزات الرئيسية:
- عرض التذكيرات المجدولة
- إدارة الإعدادات
- اختبار الإرسال
- إحصائيات في الوقت الفعلي
```

### 5. **إعدادات البريد الإلكتروني** (`src/components/EmailSettings.tsx`)
```typescript
// الميزات الرئيسية:
- تكوين خدمة البريد الإلكتروني
- إعدادات القوالب
- اختبار الإرسال
- إدارة الإعدادات المتقدمة
```

## أنواع التذكيرات

### 1. **تذكير قريب الاستحقاق** (Upcoming)
- **التوقيت**: 7 أيام، 3 أيام، يوم واحد قبل الاستحقاق
- **اللون**: أخضر (ودود)
- **المحتوى**: تذكير ودود بالدفع القريب

### 2. **تذكير متأخر** (Overdue)
- **التوقيت**: 1، 3، 7، 14 يوم بعد الاستحقاق
- **اللون**: برتقالي (تحذير)
- **المحتوى**: تحذير من التأخير مع رسوم محتملة

### 3. **إشعار نهائي** (Final Notice)
- **التوقيت**: 30 يوم بعد الاستحقاق
- **اللون**: أحمر (عاجل)
- **المحتوى**: إشعار نهائي مع تهديد بإجراءات قانونية

## إعداد النظام

### 1. **متغيرات البيئة**
```bash
# إعدادات خدمة البريد الإلكتروني
VITE_EMAIL_API_KEY=your_email_service_api_key
VITE_EMAIL_SERVICE_URL=https://api.emailservice.com
VITE_EMAIL_FROM_ADDRESS=noreply@garshain.com
VITE_EMAIL_FROM_NAME=قرشين - منصة الإقراض الرقمي

# إعدادات نظام التذكيرات
VITE_ENABLE_EMAIL_REMINDERS=true
VITE_REMINDER_CHECK_INTERVAL=24
VITE_MAX_REMINDER_ATTEMPTS=3
```

### 2. **تكوين خدمة البريد الإلكتروني**
```typescript
// في src/lib/emailService.ts
export const emailConfig: EmailConfig = {
  fromEmail: 'noreply@garshain.com',
  fromName: 'قرشين - منصة الإقراض الرقمي',
  replyTo: 'support@garshain.com',
  apiKey: import.meta.env.VITE_EMAIL_API_KEY,
  serviceUrl: import.meta.env.VITE_EMAIL_SERVICE_URL,
};
```

### 3. **تشغيل النظام**
```typescript
// في مكون التطبيق الرئيسي
import { reminderScheduler } from '@/lib/reminderScheduler';
import { loanReminderIntegration } from '@/lib/loanReminderIntegration';

// تشغيل المخطط
reminderScheduler.start();

// تهيئة قرض جديد
await loanReminderIntegration.initializeLoanReminders(adminReview, loanRequest);
```

## استخدام النظام

### 1. **إدارة التذكيرات**
```typescript
// الوصول إلى واجهة الإدارة
import { ReminderManager } from '@/components/ReminderManager';

// في مكون React
<ReminderManager />
```

### 2. **إعدادات البريد الإلكتروني**
```typescript
// الوصول إلى إعدادات البريد الإلكتروني
import { EmailSettings } from '@/components/EmailSettings';

// في مكون React
<EmailSettings />
```

### 3. **إرسال تذكير يدوي**
```typescript
import { loanReminderIntegration } from '@/lib/loanReminderIntegration';

// إرسال تذكير يدوي
await loanReminderIntegration.sendManualReminder(
  'loan-id', 
  'overdue'
);
```

## قوالب البريد الإلكتروني

### **التصميم**
- **RTL Support**: دعم كامل للغة العربية
- **Responsive**: متجاوب مع جميع الأجهزة
- **Professional**: تصميم احترافي
- **Branded**: يحمل هوية قرشين

### **المحتوى**
- **معلومات القرض**: رقم القرض، المبلغ، تاريخ الاستحقاق
- **تفاصيل المقترض**: الاسم، البريد الإلكتروني
- **روابط الدفع**: رابط مباشر للسداد
- **معلومات الدعم**: هاتف، بريد إلكتروني، دردشة

### **الألوان والرموز**
- **أخضر**: للتذكيرات الودودة
- **برتقالي**: للتحذيرات
- **أحمر**: للإشعارات العاجلة
- **رموز**: 🔔، ⚠️، 🚨 للتمييز البصري

## الإحصائيات والتقارير

### **إحصائيات النظام**
- إجمالي القروض النشطة
- القروض المتأخرة
- التذكيرات المرسلة اليوم/الأسبوع
- متوسط أيام التأخير

### **تتبع التذكيرات**
- حالة كل تذكير (معلق، مرسل، فاشل)
- عدد المحاولات
- تاريخ الإرسال
- رسائل الخطأ

## الأمان والخصوصية

### **حماية البيانات**
- تشفير مفاتيح API
- عدم تخزين محتوى البريد الإلكتروني
- حماية معلومات المقترضين

### **الامتثال**
- متوافق مع قوانين حماية البيانات
- شفافية في جمع البيانات
- إمكانية إلغاء الاشتراك

## الاختبار والتطوير

### **وضع الاختبار**
```typescript
// تفعيل وضع الاختبار
settings.enableTestMode = true;
// جميع الرسائل ستُرسل إلى البريد الاحتياطي فقط
```

### **وضع التصحيح**
```typescript
// تفعيل وضع التصحيح
settings.enableDebugMode = true;
// طباعة معلومات مفصلة في وحدة التحكم
```

### **اختبار الإرسال**
- إرسال بريد إلكتروني تجريبي
- معاينة القوالب
- اختبار الإعدادات

## استكشاف الأخطاء

### **مشاكل شائعة**

#### **التذكيرات لا تُرسل**
- تحقق من مفتاح API
- تأكد من صحة إعدادات الخدمة
- تحقق من حالة المخطط

#### **قوالب البريد الإلكتروني لا تظهر بشكل صحيح**
- تحقق من دعم RTL في عميل البريد
- تأكد من تحميل الخطوط العربية
- اختبر على أجهزة مختلفة

#### **التذكيرات لا تُجدول**
- تحقق من إعدادات التوقيت
- تأكد من صحة تواريخ الاستحقاق
- تحقق من حالة القروض

### **سجلات النظام**
```typescript
// تفعيل السجلات المفصلة
console.log('📧 Sending email:', emailData);
console.log('✅ Email sent successfully');
console.log('❌ Failed to send email:', error);
```

## التطوير المستقبلي

### **ميزات مخططة**
- **SMS Reminders**: تذكيرات عبر الرسائل النصية
- **WhatsApp Integration**: تكامل مع واتساب
- **Advanced Analytics**: تحليلات متقدمة
- **A/B Testing**: اختبار قوالب مختلفة
- **Multi-language**: دعم لغات إضافية

### **تحسينات الأداء**
- **Queue System**: نظام طوابير للإرسال
- **Rate Limiting**: تحديد معدل الإرسال
- **Caching**: تخزين مؤقت للقوالب
- **Batch Processing**: معالجة مجمعة

## الدعم والمساعدة

### **الوثائق**
- [دليل المطور](DEVELOPER_GUIDE.md)
- [API Reference](API_REFERENCE.md)
- [Troubleshooting Guide](TROUBLESHOOTING.md)

### **الاتصال**
- **البريد الإلكتروني**: dev@garshain.com
- **الهاتف**: +966 11 123 4567
- **الدردشة**: متاحة 24/7

---

## ملخص

تم تطوير نظام شامل ومتطور لتذكيرات السداد عبر البريد الإلكتروني لمنصة قرشين. يوفر النظام:

✅ **قوالب احترافية** باللغة العربية مع دعم RTL  
✅ **جدولة تلقائية** ذكية للتذكيرات  
✅ **تكامل كامل** مع النظام الموجود  
✅ **واجهة إدارة** شاملة وسهلة الاستخدام  
✅ **إحصائيات مفصلة** وتقارير في الوقت الفعلي  
✅ **أمان عالي** وحماية للبيانات  
✅ **اختبار شامل** ووضع تصحيح  

النظام جاهز للاستخدام في الإنتاج ويمكن توسيعه بسهولة لإضافة ميزات جديدة.
